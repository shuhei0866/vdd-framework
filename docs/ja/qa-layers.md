# 3層 QA モデル

## 概要

VDD Framework では、品質保証を3つの層に分けて実施する。自動テスト（Layer 1）と AI レビュー（Layer 2）で機械化可能な品質検証を行い、人間 QA（Layer 3）でユーザー体験の最終確認を行う。各層は独立しているが補完関係にある。

## 3層の構成

| Layer | 実行者 | 目的 | タイミング |
|-------|--------|------|-----------|
| **Layer 1** | AI（自動テスト） | コードの正しさを検証 | 実装中・マージ前 |
| **Layer 2** | AI（レビュー） | 設計・品質・セキュリティを検証 | マージ前 |
| **Layer 3** | 人間 | ユーザー体験を検証 | 本番昇格前 |

```
実装 (TDD)
    ↓
Layer 1: 自動テスト（テスト通過・lint・型チェック）
    ↓
Layer 2: AI レビュー（コードレビュー + 視覚チェック）
    ↓
統合ブランチにマージ
    ↓
Layer 3: 人間 QA（探索的テスト・体験確認）
    ↓
本番ブランチに昇格
```

## Layer 1: 自動テスト

### 概要

TDD で書かれたテストと CI パイプラインによる自動検証。コードの正しさを機械的に検証する。

### 実施内容

| チェック | 内容 |
|---------|------|
| 単体テスト | TDD で書かれたテストの実行 |
| 型チェック | TypeScript 等の静的型検査 |
| lint | コードスタイル・品質チェック |
| E2E テスト | 主要なユーザーフローの自動検証 |
| ビルド | 本番環境向けビルドの成功確認 |

### 実行タイミング

- **実装中**: 開発者/AI がローカルで実行
- **PR 作成時**: CI が自動実行
- **マージ前**: プリチェックコマンドで最終確認

### 期待される効果

- リグレッション（既存機能の破壊）を即座に検出
- 型安全性の保証
- コードスタイルの一貫性維持

## Layer 2: AI レビュー

### 概要

AI によるコードレビューと視覚チェック。単体テストでは検出できない設計上の問題やセキュリティリスクを発見する。

### 実施内容

| チェック | 内容 |
|---------|------|
| コードレビュー | 設計パターン、命名、ロジック、エッジケースの検証 |
| セキュリティレビュー | 脆弱性、認証/認可の問題、インジェクションリスク |
| パフォーマンスレビュー | N+1 クエリ、不要な再レンダリング等 |
| 視覚チェック | UI のスクリーンショット評価（該当する場合） |

### 多角的レビューの推奨

単一の AI によるレビューでは見落としが生じる可能性がある。異なる AI によるレビューを組み合わせることで、多角的な視点を確保する。詳細は [debate-partner.md](./debate-partner.md) を参照。

| レビュアー | 視点 |
|-----------|------|
| プロジェクト内蔵 AI レビュアー | プロジェクトのコンテキストを理解した上でのレビュー |
| 外部 AI レビュアー | 異なるモデル/視点からの独立レビュー |

### 実行タイミング

- **PR 作成前**: 自己評価 + 独立レビュー
- **PR 作成後**: 外部レビュアーによる独立レビュー

### 期待される効果

- 設計上の問題を早期発見
- セキュリティリスクの検出
- コードの品質と保守性の向上

## Layer 3: 人間 QA

### 概要

人間による探索的テスト。AI では検出困難な「違和感」やユーザー体験の問題を発見する。

### 実施内容

| チェック | 内容 |
|---------|------|
| 探索的テスト | プレビュー環境で実際に操作する |
| 体験評価 | 「使いやすいか」「わかりやすいか」の主観判断 |
| エッジケース | AI が想定しない使い方の検証 |
| ビジョン整合 | 変更がプロジェクトのビジョンに合致しているか |

### 実行タイミング

- **フィードバック会**: 統合ブランチのプレビュー環境で確認
- **本番昇格前**: 最終承認

### 期待される効果

- ユーザー目線での品質保証
- AI が見落とす「微妙な違和感」の検出
- ビジョンとの整合性の最終確認

## イテレーションループ

Layer 1 + 2 は AI が自律的にイテレーションする。問題があれば修正し、再度検証する。

```
実装 (TDD) → Layer 1 検証 → Layer 2 レビュー
    ↑                                    │
    └──── 問題あれば修正 ◀───────────────┘

全部通過 → 統合ブランチにマージ → 人間に通知
```

### 品質次元の評価

AI が各品質次元を評価し、最も弱い次元を改善する:

| 品質次元 | 評価内容 |
|---------|---------|
| コード品質 | テスト通過率、型安全性、lint 適合 |
| 設計品質 | アーキテクチャ整合、責務分離、拡張性 |
| 体験設計 | UI/UX の一貫性、アクセシビリティ |
| 機能完成度 | 仕様書の要件充足度 |

「十分」の判断基準は運用で経験的に育てる。

## Layer 間の関係

- **Layer 1 は Layer 2 の前提**: テストが通らないコードはレビューしない
- **Layer 2 は Layer 3 の前提**: AI レビューを通過していないコードは人間に見せない
- **Layer 3 は最終ゲート**: 人間が承認しなければ本番に昇格しない

### 各 Layer の守備範囲

```
Layer 1: 「壊れていないか？」（正しさ）
Layer 2: 「良く作られているか？」（品質）
Layer 3: 「使いたいか？」（価値）
```

## 関連ドキュメント

- [RDD.md](./RDD.md) — RDD のフェーズと QA の位置づけ
- [branch-strategy.md](./branch-strategy.md) — ブランチ戦略と QA の関係
- [debate-partner.md](./debate-partner.md) — 多角的レビューの詳細
