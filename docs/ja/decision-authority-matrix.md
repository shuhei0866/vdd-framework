# 意思決定権限マトリクス

## 概要

VDD/RDD において「誰が何を決定するか」を明示するマトリクスである。AI 自律開発では、人間と AI の権限境界が曖昧になりやすい。このマトリクスにより、AI が先走るべきでない判断と、AI が自律的に進めてよい判断を明確に区別する。

## 権限表

### 戦略レイヤー（VDD）

| 判断の種類 | 決定者 | 人間確認 | 基準 |
|-----------|--------|---------|------|
| ビジョンの策定・更新 | 人間 | 必須 | 会議で合意 |
| 重視する価値の変更 | 人間 | 必須 | 会議で合意 |
| 「今はやらないこと」の変更 | 人間 | 必須 | 会議で合意 |
| 品質バーの変更 | 人間 | 必須 | 会議で合意 |
| 意思決定の記録 | AI（提案）+ 人間（承認） | 必須 | approve / reject / conditional |
| 日次主観スコアの記録 | 人間 | - | 人間の主観評価 |

### 設計レイヤー（Phase 0-1）

| 判断の種類 | 決定者 | 人間確認 | 基準 |
|-----------|--------|---------|------|
| リリース仕様書の作成 | AI（提案）+ 人間（承認） | 必須 | AI が提案、人間が承認したタイミング |
| リリースの分割・統合 | 人間 + AI（設計対話） | 必須 | リリースツリーの合意 |
| リリースの優先順序 | 人間 | 必須 | ビジョンとの整合性、影響度 |
| 設計方針の採否 | 人間 | 必須 | ディベート後に approve/reject |
| スコープの変更 | 人間 | 必須 | リリース仕様書の更新が必要 |

### 実装レイヤー（Phase 2）

| 判断の種類 | 決定者 | 人間確認 | 基準 |
|-----------|--------|---------|------|
| 実装中の技術判断 | AI | 不要 | リリース仕様書のスコープ内 |
| テスト戦略の詳細 | AI | 不要 | TDD ルールに準拠 |
| リファクタリング判断 | AI | 不要 | スコープ内かつテスト通過 |
| ライブラリ/依存の追加 | AI | 不要（※） | リリース仕様書で許可されている場合 |
| アーキテクチャの変更 | 人間 | 必須 | 影響範囲が広い場合 |
| スコープ外の発見時 | AI（報告）| 必須 | 仕様に曖昧さがあれば確認 |

※ 新規の大きな依存関係の追加は人間確認を推奨

### レビュー・マージレイヤー（Phase 3-4）

| 判断の種類 | 決定者 | 人間確認 | 基準 |
|-----------|--------|---------|------|
| コードレビューの実施 | AI | 不要 | 自律的に実行 |
| レビュー指摘への対応 | AI | 不要 | 修正してコミット |
| リリースブランチ → 統合ブランチのマージ | AI | 不要 | 独立レビュアーの approve 後 |
| 統合ブランチ → 本番ブランチの昇格 | 人間 | 必須 | フィードバック会で QA 通過 |

### 運用レイヤー

| 判断の種類 | 決定者 | 人間確認 | 基準 |
|-----------|--------|---------|------|
| ホットフィックスの緊急対応 | AI（対応）+ 人間（承認） | 必須 | 本番障害時 |
| ロールバックの実行 | 人間 | 必須 | 影響範囲の判断が必要 |
| プロセス自体の改善 | 人間 + AI（提案） | 必須 | VDD 運用の振り返りで合意 |

## 原則

### 1. approve と merge の職務分離

レビュアー（独立 AI または人間）が approve し、実装エージェントがマージを実行する。1つのエンティティが approve と merge の両方を行わない。

### 2. 人間が判断すべき操作を AI が先走らない

以下は常に人間の承認を経る:
- Vision の変更
- 設計方針の決定
- 本番ブランチへの昇格
- ロールバック

### 3. 曖昧な場合は確認する

権限表に明記されていない判断は、人間に確認する。AI が「これは自分で判断していいのか？」と迷ったら、確認する側に倒す。

### 4. 自律性の範囲はスコープで定義される

AI の自律的な判断は、リリース仕様書で定義されたスコープ内に限定される。スコープ外の変更が必要な場合は、人間に報告して指示を仰ぐ。

## ガードレール

以下の状況では、AI は自律実装を停止して人間に確認する:

- Vision と矛盾する実装方針を発見した
- 根拠が追跡できない決定に依存する必要がある
- 複数の解釈が成立し、どちらを選ぶべきか不明
- 本番不具合リスクが高い変更を行う必要がある
- ユーザー影響が極めて大きい変更
- ロールバック困難な変更
- リリース仕様書のスコープ外の作業が必要

## 権限表のカスタマイズ

プロジェクトの状況に応じて権限表をカスタマイズすることを推奨する:

- **小規模プロジェクト**: AI の自律範囲を広めに設定し、速度を優先
- **大規模プロジェクト**: 人間確認を増やし、リスク管理を強化
- **セキュリティ重視**: デプロイ・DB マイグレーション等を全て人間確認必須に

## 関連ドキュメント

- [VDD.md](./VDD.md) — 戦略レイヤーの詳細
- [RDD.md](./RDD.md) — 実行レイヤーの詳細
- [qa-layers.md](./qa-layers.md) — QA の3層モデル
