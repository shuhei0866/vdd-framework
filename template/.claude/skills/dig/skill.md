---
name: dig
description: プランや要件の曖昧な点を構造化された質問で掘り下げ、意思決定を記録するスキル。VDD Phase 1（設計対話）や実装前の要件確認で使用。ユーザーが「要件を詰めたい」「曖昧なところを明確にしたい」「仕様を固めたい」「dig して」と言った場合に使用する。
---

# Dig スキル

## Overview

プランや要件の曖昧な点を特定し、構造化された質問で掘り下げて意思決定を記録するスキル。VDD Phase 1（設計対話）での仕様詰めや、実装前の要件確認に使用します。

**Announce at start:** "Dig スキルで要件の曖昧な点を掘り下げます。"

## 使用方法

```
/dig                          # 現在のプランや直近の会話から曖昧な点を掘り下げ
/dig <機能や計画の説明>        # 指定した内容について掘り下げ
/dig release/feature-name     # リリース仕様書を読んで曖昧な点を掘り下げ
```

## ワークフロー

```
┌─────────────────────────────────────────────────────┐
│                    Dig Workflow                       │
├─────────────────────────────────────────────────────┤
│  Phase 1: コンテキスト収集                            │
│     ├── CLAUDE.md / リリース仕様書 / プラン読み込み   │
│     └── 対象領域の既存コード調査                      │
│                                                     │
│  Phase 2: 曖昧点の特定                               │
│     └── カテゴリ別に分析（下記参照）                  │
│                                                     │
│  Phase 3: 構造化された質問                            │
│     ├── AskUserQuestion で 2-4 問ずつ質問            │
│     └── 各選択肢に pros/cons を付与                   │
│                                                     │
│  Phase 4: 決定事項の整理                              │
│     ├── 意思決定テーブルの出力                        │
│     └── ネクストステップの提示                        │
│                                                     │
│  ↺ Phase 2 に戻り、残りの曖昧点を再分析              │
│     └── 全ての曖昧点が解消されるまで繰り返す          │
│                                                     │
│  Phase 5: サマリー出力                                │
│     ├── 全決定事項の一覧                              │
│     └── リリース仕様書への反映提案                    │
└─────────────────────────────────────────────────────┘
```

## Phase 1: コンテキスト収集

以下のファイルを読み込んでプロジェクトの文脈を把握する：

1. **CLAUDE.md** --- プロジェクトのアーキテクチャ・規約
2. **リリース仕様書** --- 引数で指定された場合、`.claude/release-specs/{name}.md` を読む
3. **プランファイル** --- `.claude/plans/` の該当ファイル
4. **関連する既存コード** --- Glob/Grep で対象領域を調査

引数なしの場合は、直近の会話コンテキストから対象を推定する。

## Phase 2: 曖昧点の特定

以下のカテゴリで曖昧な点を洗い出す。プロジェクトの特性に応じて重点カテゴリを選ぶ：

| カテゴリ | 着眼点 |
|---------|--------|
| **アーキテクチャ** | コンポーネント構成、責務分離、レイヤー設計 |
| **データ** | テーブル設計、スキーマ、データアクセスパターン |
| **API** | エンドポイント設計、リクエスト/レスポンス型、エラーハンドリング |
| **UI/UX** | 画面遷移、レイアウト、レスポンシブ、アクセシビリティ |
| **テスト** | テスト戦略、カバレッジ範囲、E2E の範囲 |
| **セキュリティ / 認証** | 認証フロー、権限、入力バリデーション |
| **スコープ** | 含めるもの/含めないもの、将来対応に回すもの |

### 分析ルール

- 明示されていない仮定を洗い出す
- 既存コードとの整合性を確認する
- 「どちらでも良い」ではなく、具体的なトレードオフを示す
- 曖昧点が見つからないカテゴリはスキップする

## Phase 3: 構造化された質問

**必ず AskUserQuestion ツールを使用する**。会話形式の質問は使わない。

### ルール

- 1回の質問は **2-4 問**（曖昧さのレベルに応じて調整）
- 各質問に **2-4 個の具体的な選択肢**
- 各選択肢に **pros/cons を簡潔に** 記載
- オープンエンドな質問は避ける（"Other" は自動付与される）
- CLAUDE.md の既存パターンに沿った選択肢にする
- `multiSelect` は本当に必要な場合のみ使用（デフォルト: false）

### 質問の優先順位

1. **ブロッカー**: これが決まらないと他の判断ができない
2. **アーキテクチャ**: 後から変更すると影響が大きい
3. **スコープ**: 作業量に直結する
4. **UI/UX**: ユーザー体験に影響する
5. **詳細**: 実装時に判断しても問題ない

## Phase 4: 決定事項の整理

ユーザーの回答を受け取ったら、以下の形式で出力：

```markdown
## 決定事項

| 項目 | 選択 | 理由 | 備考 |
|------|------|------|------|
| データ保存方式 | DB テーブル | スケーラビリティ | マイグレーション必要 |

## ネクストステップ

1. **最初のタスク**
   - 詳細...
2. **次のタスク**
   - 詳細...
```

出力後、**Phase 2 に戻って**残りの曖昧点を再分析する。新たな曖昧点が見つかれば Phase 3 に進む。

## Phase 5: サマリー出力

全ての曖昧点が解消されたら、最終サマリーを出力：

```markdown
## Dig 完了サマリー

### 全決定事項

| # | カテゴリ | 項目 | 決定 |
|---|---------|------|------|
| 1 | アーキテクチャ | ... | ... |
| 2 | データ | ... | ... |

### リリース仕様書への反映

以下の項目をリリース仕様書に反映することを推奨：
- **設計判断**: ...
- **スコープ外**: ...
- **リスク要因**: ...

### 推奨されるリリース分割

（必要な場合のみ）リリースツリーを提案：
[R1] release/<name>
│    <概要>
│
└──▶ [R2] release/<name>
          <概要>
```

## 使用するツール

- **Read** --- コンテキストファイルの読み込み
- **Grep** --- 既存コードの調査
- **Glob** --- ファイル探索
- **AskUserQuestion** --- 構造化された質問（**必須**）

## 注意事項

- **ファイル編集はしない**: このスキルは調査と意思決定のみ。実装は別のスキル（`/tdd`, `/task-decompose` 等）で行う
- **掘り下げは徹底的に**: 表面的な質問で終わらず、回答から派生する新たな曖昧点も追求する
- **既存パターンを尊重**: プロジェクトの既存アーキテクチャや規約に反する選択肢は、その旨を明示する
