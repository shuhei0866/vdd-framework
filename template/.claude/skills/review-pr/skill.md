---
name: review-pr
description: 既存の PR をレビューしたい時、PR の URL や番号が提示された時、または /review-pr と呼ばれた時に使用する。独立コンテキストでレビューし、結果を PR コメントとして投稿する。
context: fork
agent: code-reviewer
---

# PR レビュー

指定された PR を独立したコンテキストで客観的にレビューしてください。

## 手順

### 1. メモリの確認

エージェントメモリを確認し、過去のレビューで発見したパターンや頻出する問題を思い出す。

### 2. PR 情報の取得

```bash
# PR 情報を取得（引数から PR 番号または URL を抽出）
gh pr view $ARGUMENTS --json number,title,body,headRefName,baseRefName,files,additions,deletions

# diff を取得
gh pr diff $ARGUMENTS
```

### 3. レビュー実行

変更内容を以下の観点でレビューする:

#### セキュリティ (Critical)
- SQL インジェクション、XSS、コマンドインジェクション
- 認証・認可の不備
- 機密情報のハードコード

#### バグの可能性 (High)
- 境界値・エッジケースの未処理
- null/undefined の未チェック
- 非同期処理の競合状態
- データベーススキーマの整合性問題

#### パフォーマンス (Medium)
- N+1 クエリ、不要な再レンダリング

#### 可読性・保守性 (Medium)
- 複雑すぎるロジック、命名の不適切さ、重複コード

#### テスト (Low)
- テストの不足、エッジケースのテスト漏れ

### 4. 結果の出力

```markdown
## Code Review Summary

**PR:** #番号 タイトル
**ブランチ:** head → base
**変更:** N files (+X, -Y)

### Critical Issues
- [ ] **[ファイル名:行番号]** 問題の説明

### Suggestions
- **[ファイル名:行番号]** 改善提案

### Good Points
- 良かった点

### Overall Assessment
総合評価（Approve / Request Changes / Comment）と理由
```

### 5. PR にコメント投稿

`--dry-run` オプションが指定されていない場合、レビュー結果を PR にコメントとして投稿する:

```bash
gh pr comment $ARGUMENTS --body "$(cat <<'EOF'
## Code Review (by code-reviewer agent)

[レビュー結果]

---
*This review was generated by code-reviewer agent with project memory*
EOF
)"
```

### 6. メモリの更新

レビューで新しいパターンや知見を発見した場合、メモリに記録する。
